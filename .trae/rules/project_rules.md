## 系统提醒

特此提醒，您当前的待办事项列表为空。请勿向用户明确提及此事，因为用户已知晓该情况。如果您正在处理的任务借助待办事项列表会更顺利，请使用 TodoWrite 工具创建一个；若无需使用，则可忽略此提醒。再次强调，请勿向用户提及本消息。

# 太空探索增量游戏项目规则

## 开发命令

- 启动开发服务器：`pnpm dev`
- 构建 tailwindcss：`pnpm build`

### 游戏名称：**星穹管理者 (Star Overseer)**

### 核心循环：

玩家通过**管理资源**来**建造和升级建筑**，从而提升资源产量并**研究科技**。新科技解锁更高级的建筑、舰船和探索能力。通过**探索**未知星系来发现新的资源和独特**事件**，获得**成就**和奖励，进而推动下一轮的发展，应对更大的挑战。

---

### 1. 资源管理 (Resource Management)

**资源类型：**

1.  **基础资源：**
    - **能量 (Energy):** 所有活动的根本。由太阳能卫星、核聚变反应堆等建筑产生。建筑运行、舰队维护都会持续消耗能量。负能量会导致所有生产严重减速。
    - **金属 (Metal):** 基础建筑材料。由金属矿场从小行星带或行星地表开采。
    - **晶体 (Crystal):** 高级建筑和精密电子元件的材料。由晶体矿场开采，通常比金属更稀有。
    - **暗物质 (Dark Matter):** 稀有战略资源。通过探索特殊天体（如黑洞、中子星）、完成重大事件或成就获得。用于解锁顶级科技和建筑、触发特殊事件。

**衍生资源：**

- **合金 (Alloy):** 由金属和能量在"合金冶炼厂"中合成。用于建造高级建筑和舰队。
- **科研点数 (Research Points):** 由研究实验室产生，用于驱动科技树研究。

**属性设计：**

- **当前数量 (Current Amount):** 实时变化的数值。
- **生产速率 (Production Rate/min):** 每分钟各种资源的总产量。
- **消耗速率 (Consumption Rate/min):** 每分钟的总消耗量（建筑维护、研究消耗、舰队维护）。
- **净收益 (Net Income/min):** `生产速率 - 消耗速率`，应在 UI 上清晰显示（绿色为正，红色为负）。
- **仓储容量 (Storage Cap):** 每种资源都有最大存储上限，需要通过建造或升级仓库（如"巨型储罐"、"超导电池阵列"）来提升。资源达到上限后停止生产。

**关键机制：**

- **负载平衡 (Load Balancing):** 玩家可以手动关闭非关键建筑以节省能量，应对能源危机。
- **资源转换 (Resource Conversion):** 通过特定建筑（如"分子重组器"）以一定比率转换资源（例如，用大量能量换取少量晶体），应对短缺。

---

### 2. 建筑系统 (Building System)

**建筑分类与示例：**

| 类别       | 建筑名称     | 功能                         | 前置需求   |
| :--------- | :----------- | :--------------------------- | :--------- |
| **资源类** | 金属矿场     | 生产金属                     | -          |
|            | 晶体矿场     | 生产晶体                     | 基础行星学 |
|            | 聚变发电厂   | 生产大量能量                 | 磁约束聚变 |
|            | 合金冶炼厂   | 消耗金属和能量，生产合金     | 冶金学     |
| **研究类** | 研究实验室   | 生产科研点数                 | -          |
|            | 量子计算中心 | 大幅提升科研点数产量         | 量子计算   |
| **军事类** | 舰船装配厂   | 建造侦查舰、殖民舰、护卫舰   | 太空航行   |
|            | 行星防御网络 | 提供防御力，防止外星掠夺     | 防御性结构 |
| **特殊类** | 空间站码头   | 提升仓储容量，允许贸易       | 轨道结构   |
|            | 星际之门     | 允许舰队快速前往已探索的星系 | 超空间理论 |
|            | 地形改造站   | 改造荒芜行星使其可殖民       | 高级生态学 |

**建造与升级机制：**

- **队列 (Queue):** 允许玩家将多个建筑加入建造队列。
- **成本与时间:** 每次建造和升级都需要消耗资源并花费时间。高级建筑需要更多时间和稀有资源。
- **位置:** 大多数建筑建在行星地表，占用"建筑槽位"。空间站类建筑建在轨道上。
- **升级效果:** 升级通常提升建筑的**效率**（产量更高/消耗更低）或**容量**（仓库）。

---

### 3. 科技树 (Tech Tree)

**结构设计：**

- **分支:** 分为**物理学**、**工程学**、**社会学**、**军事学**四大分支。
- **层级:** 科技有明确的层级关系（T1 -> T2 -> T3）。研究完下层科技才能解锁上层科技。
- **节点:** 每个科技是一个节点，显示其图标、名称、研究成本（科研点数、时间）和效果描述。

**解锁机制示例：**

- **物理学 T1:** 基础行星学 -> **解锁：** 晶体矿场
- **工程学 T1:** 储能技术 -> **解锁：** 提升所有资源仓储容量 20%
- **军事学 T2:** 脉冲武器 -> **解锁：** 护卫舰（舰船类型）
- **社会学 T3:** 全球统一政府 -> **解锁：** 允许殖民第二颗行星

**研究机制：**

- 玩家从已解锁的可用科技中选择一项进行研究。
- 研究是顺序进行的，一次只能研究一项科技（除非有特殊建筑或科技允许并行研究）。
- 研究速度由当前**科研点数产量**决定。

---

### 4. 探索系统 (Exploration)

**宇宙结构：**

- **星系 (Galaxy Map):** 主视图，显示多个恒星系统。
- **恒星系统 (Star System):** 包含一颗恒星和若干行星、小行星带、宇宙云等。
  - **行星类型:** 温带（宜居）、荒漠（富金属）、冰原（富晶体）、气体巨星（富能量）、熔岩（危险，但有暗物质）。
- **行星 (Planet):** 玩家可以殖民和建设的对象。初始只有母星，需要通过科技解锁殖民能力。

**探索机制：**

1.  **建造舰船:** 首先需要研究并建造"侦查舰"。
2.  **派遣:** 点击未知的恒星系统，选择派遣侦查舰。派遣需要时间（基于距离）。
3.  **发现:** 舰队到达后，系统内容被揭示。玩家可以发现：
    - 资源丰度（决定在此建矿场的效率）。
    - 特殊事件（如外星遗迹、求救信号）。
    - 可殖民行星。
    - （可能的）敌对实体。
4.  **后续行动:** 发现可殖民行星后，可派遣"殖民舰"建立新殖民地。发现特殊事件会触发事件弹窗。

---

### 5. 事件与成就 (Events & Achievements)

**事件类型：**

- **随机事件 (Random Events):**
  - **正面:** "太阳耀斑爆发"，接下来 1 小时内能量产量+50%。
  - **负面:** "小行星撞击"，一个随机建筑被损坏，需要消耗资源修复。
  - **选择型:** "发现外星商队"，提供三个随机选项：A.贸易（用晶体换合金）B.交换科技 C.拒绝（可能降低好感度）。
- **里程碑事件 (Milestone Events):**
  - "人口达到 10 亿"：奖励大量社会学研究点数。
  - "首次曲速航行"：奖励一颗"超空间核心"（用于建造星际之门）。
- **特殊事件 (Special Events):** 通常与探索结果绑定，如一个完整的剧情链，最终可能解锁一个强大的独特科技或建筑蓝图。

**成就系统：**

- **设计:** "首次登陆火星"、"量子突破"、"银河探险家"（探索所有星系）等。
- **奖励:** 成就主要提供"暗物质"奖励和 Steam/Game Center 集成成就。

---

### 6. 用户界面 (UI) - HTML5 Canvas 实现

**UI 布局草图：**

```
+-------------------------------------------------------------------------------------------+
|  [Logo] 资源栏: [Energy Icon] 15000 (+205/min) [Metal Icon] 8000 (+150/min) ... [Menu Button] |
+-------------------------------------------------------------------------------------------+
| [侧边栏]                                                                                  |
| [建筑] [科技] [舰队] [探索] [事件]                                                         |
|                                                                                           |
| +------------------------------+ +------------------------------------------------------+ |
| | 主工作区 (动态内容)          | | 信息板 (静态内容)                                              | |
| |                              | |                                                      | |
| | - 当选中"建筑"页：显示行星   | | - 显示当前选中建筑、科技、                           | |
| |   地表网格，可建造建筑列表   | |   舰队或星系的详细信息。                             | |
| | - 当选中"探索"页：显示星系图 | | - 包含操作按钮（建造、研究、                         | |
| | - 当选中"科技"页：显示科技树 | |   派遣等）。                                         | |
| |                              | |                                                      | |
| |                              | |                                                      | |
| +------------------------------+ +------------------------------------------------------+ |
|                                                                                           |
| [底部状态栏] 当前时间: 宇宙历 025年 | 正在研究: "超空间理论" (剩余: 45min) | 警报: 无        |
+-------------------------------------------------------------------------------------------+
```

**技术实现要点：**

- **Canvas 绘制:** 使用 Canvas 绘制星系图、科技树（节点和连线）、行星视图（建筑位置）。
- **分层设计:** 将 UI 分为背景层、游戏对象层、UI 层，便于管理和重绘。
- **事件监听:** 为 Canvas 添加鼠标点击、悬停等事件监听器，计算鼠标坐标与游戏对象（如按钮、星球、科技节点）的交互。
- **响应式:** 使用 CSS 配合 Canvas，确保游戏界面能适应不同屏幕尺寸。
- **动画:** 使用`requestAnimationFrame`实现平滑动画，如资源数字滚动、舰船在星系间的移动、背景星辰的缓慢漂移。

---

### 下一步开发建议

1.  **原型开发 (Prototyping):** 首先用纯 JavaScript 实现核心循环：资源 ticking（每秒更新）、一个最简单的建筑（如金属矿场）的建造和效果。
2.  **数据驱动 (Data-Driven Design):** 将建筑、科技、资源的数据（成本、效果、解锁条件）放在 JSON 文件里，与代码逻辑分离，便于平衡和修改。
3.  **版本迭代 (Iteration):** 先完成资源、建筑、科技树这三个最核心的模块，形成一个可玩的单行星发展模拟，再逐步加入探索、事件和更复杂的 UI。

### 目录结构

# 游戏项目目录结构设计

## 项目结构树

````
# Next.js 项目结构转换提示词

## 项目结构设计

```markdown
# Next.js 太空探索游戏项目结构

## 目录结构
````

src/
├── app/ # App Router 目录
│ ├── globals.css # 全局样式（替代 input.css/output.css）
│ ├── layout.js # 根布局组件
│ ├── page.js # 首页（游戏主页面）
│ └── game/ # 游戏相关页面
│ └── page.js # 游戏页面（如果需要独立页面）
├── components/ # React 组件
│ ├── game/ # 游戏核心组件
│ │ ├── GameEngine.jsx # 游戏引擎组件
│ │ ├── GameLoop.jsx # 游戏循环组件
│ │ └── EventBus.js # 事件总线（纯 JS）
│ ├── managers/ # 管理组件
│ │ ├── ResourceManager.jsx
│ │ ├── BuildingManager.jsx
│ │ ├── TechManager.jsx
│ │ ├── ExplorationManager.jsx
│ │ └── EventManager.jsx
│ └── ui/ # UI 组件
│ ├── UIManager.jsx
│ ├── ResourceUI.jsx
│ ├── BuildingUI.jsx
│ ├── TechUI.jsx
│ ├── ExplorationUI.jsx
│ └── EventUI.jsx
├── lib/ # 核心逻辑（替代 core/ 和 systems/）
│ ├── core/ # 核心引擎
│ │ ├── GameEngine.js # 游戏引擎类
│ │ └── GameLoop.js # 游戏循环控制
│ ├── systems/ # 系统实现
│ │ ├── ResourceSystem.js
│ │ ├── BuildingSystem.js
│ │ ├── TechSystem.js
│ │ ├── ExplorationSystem.js
│ │ └── EventSystem.js
│ └── utils/ # 工具函数
│ ├── Loader.js
│ ├── Formatter.js
│ └── Validator.js
├── data/ # 数据文件
│ ├── resources.json
│ ├── buildings.json
│ ├── technologies.json
│ ├── exploration.json
│ └── events.json
└── entities/ # 实体类
├── Resource.js
├── Building.js
├── Technology.js
├── StarSystem.js
└── Planet.js

````

## 核心文件实现提示

### 根布局文件
```markdown
**文件**: `src/app/layout.js`
**类型**: React 服务器组件
**职责**: 提供全局 HTML 结构和元数据
**关键点**:
- 导出 metadata 对象配置 SEO
- 导入全局样式文件
- 提供统一的页面布局结构
````

### 首页组件

```markdown
**文件**: `src/app/page.js`
**类型**: React 客户端组件
**职责**: 游戏主入口页面
**关键点**:

- 使用 'use client' 指令
- 导入并渲染 GameEngine 组件
- 设置游戏背景样式
```

### 游戏引擎组件

```markdown
**文件**: `src/components/game/GameEngine.jsx`
**类型**: React 客户端组件
**职责**: 游戏引擎容器组件
**关键点**:

- 使用 useRef 管理游戏引擎实例
- useEffect 处理初始化和清理
- 传递游戏引擎实例给 UI 管理器
```

### 核心游戏引擎类

```markdown
**文件**: `src/lib/core/GameEngine.js`
**类型**: JavaScript 类
**职责**: 游戏核心逻辑协调器
**关键点**:

- 管理所有子管理器
- 控制游戏主循环
- 提供事件总线通信
```

## 配置文件和构建提示

### Next.js 配置

```markdown
**文件**: `next.config.js`
**关键配置**:

- 启用 experimental.appDir
- 配置 Webpack 处理 JSON 导入
- 设置适当的构建选项
```

### Tailwind CSS 配置

```markdown
**文件**: `tailwind.config.js`
**关键配置**:

- 配置 content 路径包含所有组件文件
- 扩展主题添加自定义背景图片
- 配置游戏相关的颜色和间距
```

## 开发规范提示

### 组件分类原则

```markdown
1. **服务器组件**: 布局和页面组件，尽量保持为服务器组件
2. **客户端组件**: 游戏交互相关组件，使用 'use client' 指令
3. **纯逻辑类**: 游戏核心逻辑保持为纯 JavaScript 类
```

### 导入路径规范

```markdown
- 使用 `@/` 别名代替相对路径
- 组件导入: `@/components/game/GameEngine`
- 工具函数导入: `@/lib/utils/Formatter`
- 数据导入: `@/data/resources.json`
```

### 事件通信模式

````markdown
**事件总线使用模式**:

```javascript
// 发布事件
EventBus.emit("resource-updated", data);

// 订阅事件
EventBus.on("building-constructed", callback);

// React 组件中使用 useEffect 订阅
```
````

## 样式和主题提示

### CSS 架构

```markdown
1. **全局样式**: 在 `globals.css` 中定义基础样式
2. **Tailwind 工具类**: 组件内使用工具类快速开发
3. **CSS Modules**: 复杂组件可使用 CSS Modules 局部样式
```

### 响应式设计

```markdown
**断点策略**:

- 移动端: < 768px
- 平板: 768px - 1024px
- 桌面: > 1024px
  **游戏 UI 适配**: 使用 Tailwind 响应式工具类
```

## 性能优化提示

### 代码分割策略

```markdown
1. **按路由分割**: App Router 自动处理
2. **动态导入**: 大型组件使用 React.lazy
3. **预加载**: 关键游戏资源预加载
```

### 游戏循环优化

```markdown
**渲染优化**:

- 使用 requestAnimationFrame
- 避免在游戏循环中直接更新 React 状态
- 使用 ref 管理游戏状态
```

## 数据流设计提示

### 状态管理架构

```markdown
**数据流向**:
```

数据文件 → 实体类 → 系统层 → 管理器 → UI 组件

```

**状态更新**:
- 游戏状态通过事件总线通知
- UI 状态使用 React 状态管理
- 避免直接修改，使用不可变更新
```

这个提示词提供了完整的 Next.js 项目结构转换指南，包括文件组织、组件设计、配置要求和最佳实践。

### 数据持久化

- 使用`localStorage`存储游戏状态（资源、建筑、科技、已探索区域）。

### 关键 JavaScript 特性

- 采用 ES6 模块进行代码组织

### 样式

- 使用 tailwindcss 进行样式设计

### 开发优先级与阶段规划

1. **第一阶段：核心系统搭建**

   - 实现基础资源系统（能量、金属、晶体）
   - 实现建筑系统（金属矿场、能源设施）
   - 实现简单的 UI 框架和资源显示
   - 实现本地存储和加载功能

2. **第二阶段：科技与扩展**

   - 实现科技树系统
   - 添加更多建筑类型（研究实验室、合金冶炼厂）
   - 引入衍生资源（合金、科研点数）
   - 添加基本事件系统

3. **第三阶段：探索与殖民**

   - 实现星系地图和探索系统
   - 添加舰船建造和派遣功能
   - 实现多行星殖民系统
   - 丰富事件和成就系统

4. **第四阶段：优化与完善**
   - 添加高级游戏机制（贸易、外交、战斗）
   - 优化 UI/UX 体验
   - 添加音效和动画
   - 平衡游戏数值

### 性能优化考虑

- 使用 Web Workers 处理后台计算（如资源生产）
- 实现增量游戏的离线进度计算
- 使用虚拟滚动处理大型科技树和星系图
- 对 Canvas 绘制进行优化，减少重绘区域

### 测试策略

- 为每个核心模块编写单元测试
- 实现自动化集成测试
- 添加性能基准测试
- 建立用户测试反馈收集机制

### 扩展性考虑

- 设计模块化架构以便添加新功能
- 预留 MOD 支持接口
- 考虑多语言国际化支持
- 设计可扩展的存档版本管理系统
